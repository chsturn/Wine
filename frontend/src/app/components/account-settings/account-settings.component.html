<div class="settings-container">
  <h2>Account Settings</h2>

  <div *ngIf="success()" class="alert alert-success">{{ success() }}</div>
  <div *ngIf="error()" class="alert alert-danger">{{ error() }}</div>

  <!-- Profile Information Form -->
  <div class="card">
    <h3>Profile Information</h3>
    <form [formGroup]="profileForm" (ngSubmit)="updateProfile()">
      <div class="form-group">
        <label for="username">Username</label>
        <input id="username" type="text" formControlName="username">
      </div>
      <div class="form-group">
        <label for="firstname">First Name</label>
        <input id="firstname" type="text" formControlName="firstname">
      </div>
      <div class="form-group">
        <label for="lastname">Last Name</label>
        <input id="lastname" type="text" formControlName="lastname">
      </div>
      <div class="form-group">
        <label for="birthdate">Birthdate</label>
        <input id="birthdate" type="date" formControlName="birthdate">
      </div>
      <button type="submit" [disabled]="profileForm.pristine || profileForm.invalid">Update Profile</button>
    </form>
  </div>

  <!-- Change Password Form -->
  <div class="card">
    <h3>Change Password</h3>
    <form [formGroup]="passwordForm" (ngSubmit)="changePassword()">
      <div class="form-group">
        <label for="currentPassword">Current Password</label>
        <input id="currentPassword" type="password" formControlName="currentPassword">
      </div>
      <div class="form-group">
        <label for="newPassword">New Password</label>
        <input id="newPassword" type="password" formControlName="newPassword">
      </div>
      <button type="submit" [disabled]="passwordForm.invalid">Change Password</button>
    </form>
  </div>

  <!-- 2FA Management -->
  <div class="card">
    <h3>Two-Factor Authentication (2FA)</h3>
    <div class="tfa-section">
      <p>Secure your account with an extra layer of protection.</p>
      <button (click)="start2FASetup()" *ngIf="!qrCodeUrl()">Enable 2FA</button>

      <div *ngIf="qrCodeUrl()" class="setup-flow">
        <p>1. Scan this QR code with your authenticator app.</p>
        <img [src]="qrCodeUrl()" alt="2FA QR Code">
        <p>2. Enter the 6-digit code from your app to complete setup.</p>
        <form (ngSubmit)="verifyAndEnable2FA()" class="verify-form">
          <input type="text" [(ngModel)]="verificationToken" name="verificationToken" placeholder="123456" maxlength="6">
          <button type="submit">Verify & Enable</button>
        </form>
      </div>
    </div>
    <div class="tfa-section">
      <p>If you disable 2FA, your account will only be protected by your password.</p>
      <form (ngSubmit)="disable2FA()" class="disable-form">
        <label for="disablePassword">Enter your password to confirm:</label>
        <input type="password" id="disablePassword" [(ngModel)]="disablePassword" name="disablePassword">
        <button type="submit" class="btn-danger">Disable 2FA</button>
      </form>
    </div>
  </div>
</div>
